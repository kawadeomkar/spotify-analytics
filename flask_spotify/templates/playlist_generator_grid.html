<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/playlist_generator_grid.css') }}">
    <script src="{{ url_for('static', filename='bower_components/jquery/dist/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='bower_components/bootstrap/dist/js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='bower_components/d3/d3.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/playlist_generator_grid.js') }}"></script>
	<script src="https://d3js.org/d3.v5.min.js"></script>

</head
<body>
	Spotify Analytics
	<div id="genres_test"></div>
	<div id="chart"></div>
	<script>
		console.log("GENREe COUNTS");
		console.log({{genre_counts | tojson | safe}});
		var genre_counts = JSON.parse('{{ genre_counts | tojson | safe }}');

		var diameter = 600;
	    var color = d3.scaleOrdinal(d3.schemeCategory10);

	    var bubble = d3.pack(genre_counts)
	        .size([diameter, diameter])
	        .padding(1.5);
	
	    var svg = d3.select("body")
	        .append("svg")
	        .attr("width", diameter)
	        .attr("height", diameter)
	        .attr("class", "bubble");
	
	    var nodes = d3.hierarchy(genre_counts)
	        .sum(function(d) { return d.Count; });
	
	    var node = svg.selectAll(".node")
	        .data(bubble(nodes).descendants())
	        .enter()
	        .filter(function(d){
	            return  !d.children
	        })
	        .append("g")
	        .attr("class", "node")
	        .attr("transform", function(d) {
	            return "translate(" + d.x + "," + d.y + ")";
	        });
	
	    node.append("title")
	        .text(function(d) {
	            return d.Name + ": " + d.Count;
	        });
	
	    node.append("circle")
	        .attr("r", function(d) {
	            return d.r;
	        })
	        .style("fill", function(d,i) {
	            return color(i);
	        });
	
	    node.append("text")
	        .attr("dy", ".2em")
	        .style("text-anchor", "middle")
	        .text(function(d) {
	            return d.data.Name;
	        })
	        .attr("font-family", "sans-serif")
	        .attr("font-size", function(d){
	            return d.r/4;
	        })
	        .attr("fill", "white");
	
	    node.append("text")
	        .attr("dy", "1.3em")
	        .style("text-anchor", "middle")
	        .text(function(d) {
	            return d.data.Count;
	        })
	        .attr("font-family",  "Gill Sans", "Gill Sans MT")
	        .attr("font-size", function(d){
	            return d.r/5;
	        })
	        .attr("fill", "white");
	
	    d3.select(self.frameElement)
	        .style("height", diameter + "px");
	
		d3.selectAll(".node").on("click", function(bubble) {
			$SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
			console.log(bubble.Name);
			console.log(bubble.Count);
			console.log(bubble);
			$.ajax({
                		type: "POST",
                		headers: {"Content-Type": "application/json"},
                		url: "/playlist",
                		data: JSON.stringify({"Name": bubble.Name}),
				dataType: "json",
                		success: function(response) {
                		    console.log(response);
                		},
                		error: function(response, error) {
							console.log($SCRIPT_ROOT);
                		    console.log(response);
                		    console.log(error);
                		}
            		});	
		})	
	</script>
</body>
</html>
